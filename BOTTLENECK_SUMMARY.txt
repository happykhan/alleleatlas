╔═══════════════════════════════════════════════════════════════════════════╗
║                    WHERE IS TIME SPENT? (5k profiles)                     ║
╚═══════════════════════════════════════════════════════════════════════════╝

TIMELINE:
─────────────────────────────────────────────────────────────────────────────
  0s    ├─ Input parsing           [████░░░░░░░░░░░░░░░░░░░░░░░░░░░] ~9s
  9s    ├─ Parquet cache           [██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░] ~0.5s
  9.5s  ├─ DISTANCE MATRIX 🔴      [████████████████░░░░░░░░░░░░░░░░░] ~18s ⚠️ MAIN BOTTLENECK
  27.5s ├─ HierCC clustering       [██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░] ~1s
  28.5s ├─ Evaluation (NMI/Sil)    [███░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░] ~3s
  31.5s ├─ MST visualization       [██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░] ~1s
  32.5s ├─ UMAP embeddings         [██████████████░░░░░░░░░░░░░░░░░░░░░] ~3m
  ~3.5m └─ DONE ✓

BREAKDOWN BY COMPONENT:
─────────────────────────────────────────────────────────────────────────────

Input + Setup:        ~10s (3%)    ┌──┐
HierCC + Eval:        ~5s  (1%)    │██│
MST + Visual:         ~2s  (1%)    │  │
UMAP Embedding:       ~3m  (30%)   │███████░░░░░░░░░░░░░░░░░░░░░░░░░░│
Distance Matrix:      ~18s (23%)   │███████░░░░░░░░░░░░░░░░░░░░░░░░░░│  ⚠️
                                  └──┘

QUADRATIC SCALING PROBLEM:
─────────────────────────────────────────────────────────────────────────────

Distance computation: O(n²)

Size    | # Comparisons | Est. Time | Wall Clock
--------|---------------|-----------|----------
5k      | 25M           | 18s       | ~3.5 min (with embedding)
10k     | 100M          | 72s       | ~7 min
25k     | 625M          | 450s      | ~12 min
54k     | 2.9B          | 2100s     | ~40 min  ⚠️⚠️ YOUR DATASET

KEY INSIGHT: Distance matrix grows with SQUARE of profile count
─────────────────────────────────────────────────────────────────────────────

WHY COLLAPSE WON'T HELP (in current code):
─────────────────────────────────────────────────────────────────────────────

Current Flow:
  54,595 raw profiles
        ↓
    Normalize input (10s)
        ↓
    [OPTIONAL: Pre-collapse - not yet implemented]
        ↓
    Compute 54k×54k distances (2100s) ⚠️ THIS STILL HAPPENS!
        ↓
    Clustering (1m)
        ↓
    Done

Your suggestion (what WOULD help):
  54,595 raw profiles
        ↓
    Group by exact match (HC0) [instant] → ~5,000 unique ✓
        ↓
    Compute 5k×5k distances (18s) instead of 54k×54k!  ✓✓✓
        ↓
    Re-expand results to all 54k [fast]
        ↓
    Clustering
        ↓
    Done in ~3 minutes instead of 40!

STATUS: Feature NOT YET implemented, but would give 10x speedup!
─────────────────────────────────────────────────────────────────────────────
